(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[368],{78445:function(e,t,r){"use strict";r.d(t,{Z:function(){return y}});var n=r(63366),a=r(87462),o=r(67294),i=r(63961),s=r(58510),c=r(15861),l=r(71657),u=r(90948),d=r(1977),h=r(8027);function p(e){return(0,h.ZP)("MuiCardHeader",e)}var m=(0,d.Z)("MuiCardHeader",["root","avatar","action","content","title","subheader"]),f=r(85893);const v=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],g=(0,u.ZP)("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(e,t)=>(0,a.Z)({[`& .${m.title}`]:t.title,[`& .${m.subheader}`]:t.subheader},t.root)})({display:"flex",alignItems:"center",padding:16}),Z=(0,u.ZP)("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(e,t)=>t.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),x=(0,u.ZP)("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(e,t)=>t.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),b=(0,u.ZP)("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(e,t)=>t.content})({flex:"1 1 auto"});var y=o.forwardRef((function(e,t){const r=(0,l.Z)({props:e,name:"MuiCardHeader"}),{action:o,avatar:u,className:d,component:h="div",disableTypography:m=!1,subheader:y,subheaderTypographyProps:j,title:C,titleTypographyProps:P}=r,k=(0,n.Z)(r,v),w=(0,a.Z)({},r,{component:h,disableTypography:m}),S=(e=>{const{classes:t}=e;return(0,s.Z)({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},p,t)})(w);let _=C;null==_||_.type===c.Z||m||(_=(0,f.jsx)(c.Z,(0,a.Z)({variant:u?"body2":"h5",className:S.title,component:"span",display:"block"},P,{children:_})));let z=y;return null==z||z.type===c.Z||m||(z=(0,f.jsx)(c.Z,(0,a.Z)({variant:u?"body2":"body1",className:S.subheader,color:"text.secondary",component:"span",display:"block"},j,{children:z}))),(0,f.jsxs)(g,(0,a.Z)({className:(0,i.Z)(S.root,d),as:h,ref:t,ownerState:w},k,{children:[u&&(0,f.jsx)(Z,{className:S.avatar,ownerState:w,children:u}),(0,f.jsxs)(b,{className:S.content,ownerState:w,children:[_,z]}),o&&(0,f.jsx)(x,{className:S.action,ownerState:w,children:o})]}))}))},69368:function(e,t,r){"use strict";r.d(t,{Z:function(){return _}});var n=r(63366),a=r(87462),o=r(67294),i=r(63961),s=r(58510),c=r(2101),l=r(21964),u=r(88169),d=r(85893),h=(0,u.Z)((0,d.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),p=(0,u.Z)((0,d.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),m=(0,u.Z)((0,d.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox"),f=r(98216),v=r(71657),g=r(90948),Z=r(14136),x=r(1977),b=r(8027);function y(e){return(0,b.ZP)("MuiCheckbox",e)}var j=(0,x.Z)("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]);const C=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],P=(0,g.ZP)(l.Z,{shouldForwardProp:e=>(0,Z.Z)(e)||"classes"===e,name:"MuiCheckbox",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.indeterminate&&t.indeterminate,t[`size${(0,f.Z)(r.size)}`],"default"!==r.color&&t[`color${(0,f.Z)(r.color)}`]]}})((({theme:e,ownerState:t})=>(0,a.Z)({color:(e.vars||e).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${"default"===t.color?e.vars.palette.action.activeChannel:e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,c.Fq)("default"===t.color?e.palette.action.active:e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==t.color&&{[`&.${j.checked}, &.${j.indeterminate}`]:{color:(e.vars||e).palette[t.color].main},[`&.${j.disabled}`]:{color:(e.vars||e).palette.action.disabled}}))),k=(0,d.jsx)(p,{}),w=(0,d.jsx)(h,{}),S=(0,d.jsx)(m,{});var _=o.forwardRef((function(e,t){var r,c;const l=(0,v.Z)({props:e,name:"MuiCheckbox"}),{checkedIcon:u=k,color:h="primary",icon:p=w,indeterminate:m=!1,indeterminateIcon:g=S,inputProps:Z,size:x="medium",className:b}=l,j=(0,n.Z)(l,C),_=m?g:p,z=m?g:u,N=(0,a.Z)({},l,{color:h,indeterminate:m,size:x}),M=(e=>{const{classes:t,indeterminate:r,color:n,size:o}=e,i={root:["root",r&&"indeterminate",`color${(0,f.Z)(n)}`,`size${(0,f.Z)(o)}`]},c=(0,s.Z)(i,y,t);return(0,a.Z)({},t,c)})(N);return(0,d.jsx)(P,(0,a.Z)({type:"checkbox",inputProps:(0,a.Z)({"data-indeterminate":m},Z),icon:o.cloneElement(_,{fontSize:null!=(r=_.props.fontSize)?r:x}),checkedIcon:o.cloneElement(z,{fontSize:null!=(c=z.props.fontSize)?c:x}),ownerState:N,ref:t,className:(0,i.Z)(M.root,b)},j,{classes:M}))}))},17658:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dispense/checkout/[memberCode]",function(){return r(10198)}])},86078:function(e,t,r){"use strict";var n=r(47568),a=r(97582),o=r(85893),i=r(11163),s=r(67294),c=r(5121);t.Z=function(e){var t=e.children,r=(0,i.useRouter)();return(0,s.useEffect)((function(){var e=function(){var e=(0,n.Z)((function(){var e,t,n;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:if(!(e=sessionStorage.getItem("token")))return r.push("/login"),[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,c.Z.get("".concat("http://localhost:5000","/api/public/user-type"),{headers:{Authorization:"Bearer ".concat(e)},withCredentials:!0})];case 2:return t=a.sent(),console.log(t.data),"false"===t.data?r.push("/login"):"member"===t.data&&r.push("/user"),[3,4];case 3:return n=a.sent(),console.error("Error checking authentication:",n),r.push("/login"),[3,4];case 4:return[2]}}))}));return function(){return e.apply(this,arguments)}}();e()}),[r]),(0,o.jsx)(o.Fragment,{children:t})}},10198:function(e,t,r){"use strict";r.r(t);var n=r(47568),a=r(97582),o=r(85893),i=r(5121),s=r(11163),c=r(67294),l=r(86078),u=r(86886),d=r(66242),h=r(44267),p=r(15861),m=r(5616),f=r(50135),v=r(87109),g=r(60856),Z=r(69368),x=r(69417),b=r(78445),y=r(67720),j=r(72882),C=r(7906),P=r(53184),k=r(53816),w=r(98102),S=r(295);t.default=function(){var e=(0,s.useRouter)(),t=e.query,r=t.memberCode,_=t.products,z=(0,c.useState)(null),N=z[0],M=z[1],E=(0,c.useState)(""),I=E[0],R=E[1],B=(0,c.useState)(""),H=B[0],T=B[1],$=(0,c.useState)(!1),A=$[0],O=$[1],D=(0,c.useState)([]),F=D[0],V=D[1],W=(0,c.useState)(!1),q=W[0],L=W[1],X=(0,c.useState)(!1),G=(X[0],X[1]),J="undefined"!==typeof sessionStorage?sessionStorage.getItem("token"):null;(0,c.useEffect)((function(){var e=function(){var e=(0,n.Z)((function(){var e,t;return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,i.Z.get("".concat("http://localhost:5000","/api/protected/members/").concat(r),{headers:{Authorization:"Bearer ".concat(J)},withCredentials:!0})];case 1:return(e=n.sent()).data&&e.data.length>0&&M(e.data[0]),[3,3];case 2:return t=n.sent(),console.error("Error fetching member data:",t),[3,3];case 3:return[2]}}))}));return function(){return e.apply(this,arguments)}}();T(function(){var e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(n)}()),e()}),[r]);var Y=function(e){try{return JSON.parse(e)}catch(t){return null}}(_),K=Array.isArray(Y)&&Y.length>0;(0,c.useEffect)((function(){if(console.log("useEffect triggered:",K,Y,q),K&&!q){L(!0);var e=function(){var e=(0,n.Z)((function(){var e,t,r;return(0,a.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,3,4]),e=Y.map(function(){var e=(0,n.Z)((function(e){return(0,a.__generator)(this,(function(t){switch(t.label){case 0:return[4,i.Z.get("".concat("http://localhost:5000","/api/protected/cannabisProducts/").concat(e._id),{headers:{Authorization:"Bearer ".concat(J)},withCredentials:!0})];case 1:return[2,t.sent().data]}}))}));return function(t){return e.apply(this,arguments)}}()),[4,Promise.all(e)];case 1:return t=o.sent(),V(t),[3,4];case 2:return r=o.sent(),console.error("Error fetching product details:",r),V([]),[3,4];case 3:return L(!1),[7];case 4:return[2]}}))}));return function(){return e.apply(this,arguments)}}();e()}}),[K]);var Q=function(){var t=(0,n.Z)((function(t){var n,o;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:t.preventDefault(),G(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),n={memberCode:r,checkoutDate:H,comments:I,isGift:A,products:Y.map((function(e){var t=F.find((function(t){return t._id===e._id}));return{productId:e._id,name:null===t||void 0===t?void 0:t.name,category:null===t||void 0===t?void 0:t.category,salePrice:null===t||void 0===t?void 0:t.salePrice,weight:e.weight,subtotal:t?t.salePrice*e.weight:0}}))},[4,i.Z.post("".concat("http://localhost:5000","/api/protected/checkout"),n,{headers:{Authorization:"Bearer ".concat(J)},withCredentials:!0})];case 2:return a.sent(),alert("Checkout successful"),e.push("/members/profile/".concat(r)),[3,5];case 3:return o=a.sent(),console.error("Error during checkout:",o),alert("Checkout failed. Please try again."),[3,5];case 4:return G(!1),[7];case 5:return[2]}}))}));return function(e){return t.apply(this,arguments)}}();return N?(0,o.jsx)(l.Z,{children:(0,o.jsx)(u.ZP,{container:!0,spacing:6,children:(0,o.jsx)(u.ZP,{item:!0,xs:12,children:(0,o.jsxs)(d.Z,{sx:{p:4},children:[(0,o.jsx)(b.Z,{title:"Checkout",titleTypographyProps:{variant:"h6"}}),(0,o.jsx)(y.Z,{sx:{margin:0}}),(0,o.jsx)(h.Z,{children:(0,o.jsxs)("form",{onSubmit:Q,children:[(0,o.jsxs)(m.Z,{sx:{display:"flex",alignItems:"center",pb:5,gap:10},children:[(0,o.jsxs)(m.Z,{children:[(0,o.jsxs)(p.Z,{variant:"h6",children:[N.firstName," ",N.lastName," # ",r]}),K?(0,o.jsx)(j.Z,{component:d.Z,children:(0,o.jsxs)(C.Z,{sx:{minWidth:650},"aria-label":"simple table",children:[(0,o.jsx)(P.Z,{children:(0,o.jsxs)(k.Z,{children:[(0,o.jsx)(w.Z,{children:"Category"}),(0,o.jsx)(w.Z,{children:"Product Name"}),(0,o.jsx)(w.Z,{align:"right",children:"Weight"}),(0,o.jsx)(w.Z,{align:"right",children:"Price"})]})}),(0,o.jsx)(S.Z,{children:Y.map((function(e,t){var r=F.find((function(t){return t._id===e._id}));if(!r)return null;var n=r.salePrice*e.weight;return(0,o.jsxs)(k.Z,{children:[(0,o.jsx)(w.Z,{component:"th",scope:"row",children:r.category}),(0,o.jsx)(w.Z,{component:"th",scope:"row",children:r.name}),(0,o.jsxs)(w.Z,{align:"right",children:[e.weight," g"]}),(0,o.jsxs)(w.Z,{align:"right",children:["$",n.toFixed(2)]})]},t)}))})]})}):(0,o.jsx)("p",{children:_?"Invalid products data":"No products data available"})]}),(0,o.jsxs)(u.ZP,{item:!0,xs:6,children:[(0,o.jsx)(u.ZP,{item:!0,xs:12,sx:{pb:5},children:(0,o.jsx)(f.Z,{fullWidth:!0,label:"Date",type:"date",value:H,onChange:function(e){return T(e.target.value)},InputProps:{startAdornment:(0,o.jsx)(v.Z,{position:"start"})},required:!0})}),(0,o.jsx)(u.ZP,{item:!0,xs:12,sx:{pb:5},children:(0,o.jsx)(f.Z,{fullWidth:!0,label:"Comments",placeholder:"Comments",multiline:!0,value:I,sx:{"& .MuiOutlinedInput-root":{alignItems:"baseline"}},minRows:3,onChange:function(e){return R(e.target.value)}})}),(0,o.jsx)(u.ZP,{item:!0,xs:12,children:(0,o.jsx)(g.Z,{label:"Add this as a gift?",control:(0,o.jsx)(Z.Z,{name:"gift-checkbox"}),checked:A,onChange:function(){return O(!A)},sx:{"& .MuiButtonBase-root":{paddingTop:0,paddingBottom:0}}})})]})]}),(0,o.jsx)(u.ZP,{item:!0,xs:6,sx:{pt:10},children:(0,o.jsx)(x.Z,{size:"large",variant:"contained",sx:{marginBottom:7},type:"submit",children:"Checkout"})})]})})]})})})}):(0,o.jsx)("p",{children:"Loading member data..."})}}},function(e){e.O(0,[2657,7709,8360,3678,9254,1620,8682,9774,2888,179],(function(){return t=17658,e(e.s=t);var t}));var t=e.O();_N_E=t}]);